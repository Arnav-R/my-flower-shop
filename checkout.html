<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" href="style4.css">
    <link href="https://fonts.googleapis.com/css2?family=Avenir:wght@700&family=Gill+Sans&display=swap" rel="stylesheet">
            <script type="module">
        import emailjs from 'https://cdn.emailjs.com/dist/email.min.js';
    </script>
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
</script>
<script type="text/javascript">
   (function(){
      emailjs.init({
        publicKey: "J8ruAJ42CSDff3OJE",
      });
   })();
</script>
</head>
<body>
    <div class="container">
        <!-- Vertical Navigation Bar -->
        <nav class="vertical-nav">
            <ul>
                <li><a href="index.html" class="icon home">üè†</a></li>
                <li><a href="#" class="icon products">üõí</a></li>
                <li><a href="#" class="icon care">üåø</a></li>
                <li><a href="#" class="icon contact">üìû</a></li>
            </ul>
        </nav>

        <!-- Vertical Heading -->
        <div class="vertical-heading">CHECKOUT</div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="left-section">
                <textarea id="address" name="address" placeholder="Enter your address here..."></textarea>
                <ul class="cart-item-list">
                    <!-- Dynamically filled by renderCartItems -->
                </ul>
                <div class="total-price">
                    <p><strong>TOTAL PRICE: $0</strong></p>
                </div>
                <button class="confirm-order-btn">CONFIRM ORDER</button>
            </div>

            <div class="right-section">
                <img src="tulips.png" alt="Pink Tulips" class="main-image">
            </div>
        </main>
    </div>

    <script>
        // Initialize EmailJS
        emailjs.init("J8ruAJ42CSDff3OJE");

        const savedCart = JSON.parse(localStorage.getItem("cart")) || [];
        const cartItemList = document.querySelector(".cart-item-list");
        const totalPriceElement = document.querySelector(".total-price strong");
        const confirmOrderBtn = document.querySelector(".confirm-order-btn");
        const addressInput = document.querySelector("#address");

        function updateTotalPrice() {
            let totalPrice = 0;
            savedCart.forEach(item => {
                totalPrice += item.price * item.quantity;
            });
            totalPriceElement.textContent = `TOTAL PRICE: $${totalPrice.toFixed(2)}`;
        }

        function renderCartItems() {
            cartItemList.innerHTML = "";
            savedCart.forEach((item, index) => {
                const listItem = document.createElement("li");
                listItem.classList.add("cart-item");
                listItem.innerHTML = `
                    ${item.name} - $${item.price} x ${item.quantity}
                    <button class="remove-btn" data-index="${index}">-</button>
                `;
                cartItemList.appendChild(listItem);
            });
            updateTotalPrice();
        }

        cartItemList.addEventListener("click", (e) => {
            if (e.target.classList.contains("remove-btn")) {
                const index = e.target.getAttribute("data-index");
                savedCart.splice(index, 1);
                localStorage.setItem("cart", JSON.stringify(savedCart));
                renderCartItems();
            }
        });

        confirmOrderBtn.addEventListener("click", () => {
            const address = addressInput.value.trim();
            if (!address) {
                alert("Please enter your address.");
                return;
            }

            const cartItemsHtml = savedCart.map(item => 
                `<li>${item.name} - $${item.price} x ${item.quantity}</li>`
            ).join("");

            const emailData = {
                to_name: "Store Owner",
                from_name: "Checkout Page",
                address: address,
                cart_items: cartItemsHtml,
                total_price: totalPriceElement.textContent,
            };

            emailjs.send("service_n34ia37", "template_jmn5xt5", emailData)
                .then(() => {
                    alert("Order confirmed! An email has been sent.");
                    window.location.href = "index.html";
                })
                .catch(error => {
                    console.error("Failed to send email:", error);
                    alert("There was an error sending the email. Please try again.");
                });
        });

        renderCartItems();
    </script>
</body>
</html>
